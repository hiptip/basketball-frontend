{"ast":null,"code":"import _createForOfIteratorHelper from\"/Users/nickboston/Documents/basketball-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _slicedToArray from\"/Users/nickboston/Documents/basketball-frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from'react';import'./App.css';import{getMainColor,getFullName}from'nba-color';import ConnectHue from'./components/ConnectHue';import LiveGames from'./components/LiveGames';import{RGBtoXY,getGradientColor,hexToRgb}from'./util/colorFunctions';import PickColors from'./components/PickColors';import\"./styles.css\";import GamePage from'./components/GamePage';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var App=function App(){var _useState=useState(\"#1271ff\"),_useState2=_slicedToArray(_useState,2),homeColor=_useState2[0],setHomeColor=_useState2[1];var _useState3=useState(\"#009e05\"),_useState4=_slicedToArray(_useState3,2),awayColor=_useState4[0],setAwayColor=_useState4[1];var _useState5=useState([247,232,195]),_useState6=_slicedToArray(_useState5,2),neutralColor=_useState6[0],setNeutralColor=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),currentIntervalId=_useState8[0],setCurrentIntervalId=_useState8[1];var _useState9=useState(\"#f7e8c3\"),_useState10=_slicedToArray(_useState9,2),lightColorHex=_useState10[0],setLightColorHex=_useState10[1];var _React$useState=React.useState(null),_React$useState2=_slicedToArray(_React$useState,2),anchorEl=_React$useState2[0],setAnchorEl=_React$useState2[1];var _useState11=useState(false),_useState12=_slicedToArray(_useState11,2),hueConfigured=_useState12[0],setHueConfigured=_useState12[1];var _useState13=useState(),_useState14=_slicedToArray(_useState13,2),hueUsername=_useState14[0],setHueUsername=_useState14[1];//\"rpFOVnRT3f3nX484o6arbY-HzrnjjObfsihT3n82\"\nvar _useState15=useState(),_useState16=_slicedToArray(_useState15,2),bridgeIp=_useState16[0],setBridgeIp=_useState16[1];var _useState17=useState([]),_useState18=_slicedToArray(_useState17,2),liveGames=_useState18[0],setLiveGames=_useState18[1];var _useState19=useState(),_useState20=_slicedToArray(_useState19,2),homeTeam=_useState20[0],setHomeTeam=_useState20[1];var _useState21=useState(),_useState22=_slicedToArray(_useState21,2),awayTeam=_useState22[0],setAwayTeam=_useState22[1];var _useState23=useState(''),_useState24=_slicedToArray(_useState23,2),timeStamp=_useState24[0],setTimeStamp=_useState24[1];var _useState25=useState(30000),_useState26=_slicedToArray(_useState25,2),delay=_useState26[0],setDelay=_useState26[1];var _useState27=useState([]),_useState28=_slicedToArray(_useState27,2),checkedLights=_useState28[0],setCheckedLights=_useState28[1];var _useState29=useState(false),_useState30=_slicedToArray(_useState29,2),gameView=_useState30[0],setGameView=_useState30[1];var _useState31=useState({}),_useState32=_slicedToArray(_useState31,2),singleGameData=_useState32[0],setSingleGameData=_useState32[1];var _useState33=useState({}),_useState34=_slicedToArray(_useState33,2),lights=_useState34[0],setLights=_useState34[1];// const handleClick = (event) => {\n//   setAnchorEl(event.currentTarget);\n// };\n// const handleClose = () => {\n//   setAnchorEl(null);\n// };\nwindow.addEventListener(\"beforeunload\",function(e){// Reset lights to previous values\nfor(var _i=0,_Object$entries=Object.entries(lights);_i<_Object$entries.length;_i++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i],2),key=_Object$entries$_i[0],value=_Object$entries$_i[1];var light=key;var x=lights[light].state.xy[0];var y=lights[light].state.xy[1];setColor(x,y,light);}},false);var getAllGames=function getAllGames(){fetch('https://nba-hue-backend.herokuapp.com/games?'+new URLSearchParams({delay:delay})).then(function(response){return response.json();}).then(function(response){setLiveGames(response);});};// const getGameScore = () => {\n//   console.log(timeStamp)\n//   fetch('/games?' + new URLSearchParams({\n//     homeTeam: homeTeam,\n//     delay: delay,\n//     // timeStamp: timeStamp\n//   }))\n//     .then(response => response.json())\n//     .then(response => {\n//       if (response[0]) {\n//         // setTimeStamp(response[0].timeStamp) @TODO\n//         return scoreToXY(parseInt(response[0].homeScore), parseInt(response[0].awayScore))\n//       }\n//     }) //calculate color from scores\n//     .then(colorXY => {\n//       setColor(colorXY[0], colorXY[1])\n//     }) //set color   \n// }\nvar controlLights=function controlLights(game){if(game){var colorXY=scoreToXY(parseInt(game.homeScore),parseInt(game.awayScore));setColor(colorXY[0],colorXY[1],checkedLights);//seems like this isn't actually updating\n}};var scoreToXY=function scoreToXY(hScore,vScore){var neutralHex=\"#FFC94A\";if(hScore===vScore){return RGBtoXY(neutralColor[0],neutralColor[1],neutralColor[2]);}if(hScore>vScore){var diff=hScore-vScore;var percent=diff/20;var gradientColor=getGradientColor(neutralHex,homeColor,percent);//update this\nsetLightColorHex(gradientColor);var rgb=hexToRgb(gradientColor);if(rgb){return RGBtoXY(rgb.r,rgb.g,rgb.b);}}if(hScore<vScore){var _diff=vScore-hScore;var _percent=_diff/20;var _gradientColor=getGradientColor(neutralHex,awayColor,_percent);//update this\nsetLightColorHex(_gradientColor);var _rgb=hexToRgb(_gradientColor);if(_rgb){return RGBtoXY(_rgb.r,_rgb.g,_rgb.b);}}};useEffect(function(){// check local storage for hue username\nvar username=localStorage.getItem(\"hueUsername\");if(username){setHueUsername(username);}},[]);useEffect(function(){if(gameView){var singleGame=liveGames.find(function(game){return game.homeTeam===homeTeam;});controlLights(singleGame,checkedLights);}},[liveGames]);useEffect(function(){//update this logic\ngamePolling();},[hueConfigured,delay]);var setColor=function setColor(x,y,lights){var _iterator=_createForOfIteratorHelper(lights.entries()),_step;try{for(_iterator.s();!(_step=_iterator.n()).done;){var _step$value=_slicedToArray(_step.value,2),index=_step$value[0],val=_step$value[1];fetch(\"http://\".concat(bridgeIp,\"/api/\").concat(hueUsername,\"/lights/\").concat(val,\"/state\"),{method:'PUT',body:JSON.stringify({\"xy\":[x,y]})});}}catch(err){_iterator.e(err);}finally{_iterator.f();}};// const gamePolling = () => {\n//   if (currentIntervalId) {\n//     clearInterval(currentIntervalId)\n//   }\n//   var intId = setInterval(() => {\n//     getAllGames()\n//   }, 6000)\n//   setCurrentIntervalId(intId)\n// }\nvar gamePolling=function gamePolling(){if(currentIntervalId){clearInterval(currentIntervalId);}var intId=setInterval(function(){getAllGames();},2000);setCurrentIntervalId(intId);};return/*#__PURE__*/_jsxs(\"div\",{children:[!hueConfigured&&/*#__PURE__*/_jsx(ConnectHue,{setHueUsername:setHueUsername,setHueConfigured:setHueConfigured,hueUsername:hueUsername,setCheckedLights:setCheckedLights,setBridgeIp:setBridgeIp,bridgeIp:bridgeIp,setLights:setLights}),hueConfigured&&!gameView&&/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(LiveGames,{lightColorHex:lightColorHex,liveGames:liveGames,setHomeTeam:setHomeTeam,setAwayTeam:setAwayTeam,setAwayColor:setAwayColor,setHomeColor:setHomeColor,awayTeam:awayTeam,homeTeam:homeTeam,setGameView:setGameView,setSingleGameData:setSingleGameData}),/*#__PURE__*/_jsx(PickColors,{setAwayColor:setAwayColor,setHomeColor:setHomeColor,awayTeam:awayTeam,homeTeam:homeTeam,setGameView:setGameView})]}),hueConfigured&&gameView&&/*#__PURE__*/_jsx(GamePage,{setDelay:setDelay,setIntervalId:setCurrentIntervalId,intervalId:currentIntervalId,delay:delay,homeTeam:homeTeam,awayTeam:awayTeam,homeColor:homeColor,awayColor:awayColor,liveGames:liveGames,setGameView:setGameView,gameView:gameView,lightColorHex:lightColorHex,setHomeColor:setHomeColor,setAwayColor:setAwayColor})]});};export default App;","map":{"version":3,"sources":["/Users/nickboston/Documents/basketball-frontend/src/App.js"],"names":["React","useState","useEffect","getMainColor","getFullName","ConnectHue","LiveGames","RGBtoXY","getGradientColor","hexToRgb","PickColors","GamePage","App","homeColor","setHomeColor","awayColor","setAwayColor","neutralColor","setNeutralColor","currentIntervalId","setCurrentIntervalId","lightColorHex","setLightColorHex","anchorEl","setAnchorEl","hueConfigured","setHueConfigured","hueUsername","setHueUsername","bridgeIp","setBridgeIp","liveGames","setLiveGames","homeTeam","setHomeTeam","awayTeam","setAwayTeam","timeStamp","setTimeStamp","delay","setDelay","checkedLights","setCheckedLights","gameView","setGameView","singleGameData","setSingleGameData","lights","setLights","window","addEventListener","e","Object","entries","key","value","light","x","state","xy","y","setColor","getAllGames","fetch","URLSearchParams","then","response","json","controlLights","game","colorXY","scoreToXY","parseInt","homeScore","awayScore","hScore","vScore","neutralHex","diff","percent","gradientColor","rgb","r","g","b","username","localStorage","getItem","singleGame","find","gamePolling","index","val","method","body","JSON","stringify","clearInterval","intId","setInterval"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport './App.css';\nimport { getMainColor, getFullName } from 'nba-color';\nimport ConnectHue from './components/ConnectHue'\nimport LiveGames from './components/LiveGames';\nimport { RGBtoXY, getGradientColor, hexToRgb } from './util/colorFunctions'\nimport PickColors from './components/PickColors';\nimport \"./styles.css\";\nimport GamePage from './components/GamePage';\n\nconst App = () => {\n  const [homeColor, setHomeColor] = useState(\"#1271ff\")\n  const [awayColor, setAwayColor] = useState(\"#009e05\")\n  const [neutralColor, setNeutralColor] = useState([247, 232, 195])\n  const [currentIntervalId, setCurrentIntervalId] = useState()\n  const [lightColorHex, setLightColorHex] = useState(\"#f7e8c3\")\n  const [anchorEl, setAnchorEl] = React.useState(null);\n  const [hueConfigured, setHueConfigured] = useState(false)\n  const [hueUsername, setHueUsername] = useState() //\"rpFOVnRT3f3nX484o6arbY-HzrnjjObfsihT3n82\"\n  const [bridgeIp, setBridgeIp] = useState()\n  const [liveGames, setLiveGames] = useState([])\n  const [homeTeam, setHomeTeam] = useState()\n  const [awayTeam, setAwayTeam] = useState()\n  const [timeStamp, setTimeStamp] = useState('')\n  const [delay, setDelay] = useState(30000)\n  const [checkedLights, setCheckedLights] = useState([])\n  const [gameView, setGameView] = useState(false)\n  const [singleGameData, setSingleGameData] = useState({})\n  const [lights, setLights] = useState({})\n\n  // const handleClick = (event) => {\n  //   setAnchorEl(event.currentTarget);\n  // };\n\n  // const handleClose = () => {\n  //   setAnchorEl(null);\n  // };\n\n  window.addEventListener(\"beforeunload\", function(e){\n    // Reset lights to previous values\n    for (const [key, value] of Object.entries(lights)) {\n      var light = key;\n      var x = lights[light].state.xy[0]\n      var y = lights[light].state.xy[1]\n      setColor(x, y, light)\n    }\n }, false);\n\n  const getAllGames = () => {\n    fetch('https://nba-hue-backend.herokuapp.com/games?' + new URLSearchParams({\n      delay: delay,\n    }))\n      .then(response => response.json())\n      .then(response => {\n        setLiveGames(response)\n      })\n  }\n\n  // const getGameScore = () => {\n  //   console.log(timeStamp)\n  //   fetch('/games?' + new URLSearchParams({\n  //     homeTeam: homeTeam,\n  //     delay: delay,\n  //     // timeStamp: timeStamp\n  //   }))\n  //     .then(response => response.json())\n  //     .then(response => {\n  //       if (response[0]) {\n  //         // setTimeStamp(response[0].timeStamp) @TODO\n  //         return scoreToXY(parseInt(response[0].homeScore), parseInt(response[0].awayScore))\n  //       }\n  //     }) //calculate color from scores\n  //     .then(colorXY => {\n  //       setColor(colorXY[0], colorXY[1])\n  //     }) //set color   \n  // }\n\n  const controlLights = (game) => {\n    if (game) {\n      let colorXY = scoreToXY(parseInt(game.homeScore), parseInt(game.awayScore))\n      setColor(colorXY[0], colorXY[1], checkedLights) //seems like this isn't actually updating\n    }\n  }\n\n  const scoreToXY = (hScore, vScore) => {\n    const neutralHex = \"#FFC94A\"\n    if (hScore === vScore) {\n      return RGBtoXY(neutralColor[0], neutralColor[1], neutralColor[2])\n    }\n    if (hScore > vScore) {\n      let diff = hScore - vScore\n      let percent = diff / 20\n      let gradientColor = getGradientColor(neutralHex, homeColor, percent) //update this\n      setLightColorHex(gradientColor)\n      let rgb = hexToRgb(gradientColor)\n      if (rgb) {\n        return RGBtoXY(rgb.r, rgb.g, rgb.b)\n      }\n    }\n    if (hScore < vScore) {\n      let diff = vScore - hScore\n      let percent = diff / 20\n      let gradientColor = getGradientColor(neutralHex, awayColor, percent) //update this\n      setLightColorHex(gradientColor)\n      let rgb = hexToRgb(gradientColor)\n      if (rgb) {\n        return RGBtoXY(rgb.r, rgb.g, rgb.b)\n      }\n    }\n  }\n\n\n  useEffect(() => {\n    // check local storage for hue username\n    let username = localStorage.getItem(\"hueUsername\")\n    if (username) {\n      setHueUsername(username)\n    }\n  }, []);\n\n  useEffect(() => {\n    if (gameView) {\n      var singleGame = liveGames.find(game => game.homeTeam === homeTeam)\n      controlLights(singleGame, checkedLights)\n    }\n  }, [liveGames])\n\n  useEffect(() => { //update this logic\n    gamePolling()\n  }, [hueConfigured, delay])\n\n  const setColor = (x, y, lights) => {\n    for (let [index, val] of lights.entries()) {\n      fetch(`http://${bridgeIp}/api/${hueUsername}/lights/${val}/state`, { \n        method: 'PUT',\n        body: JSON.stringify({ \"xy\": [x, y] })\n      })\n    }\n\n  }\n\n  // const gamePolling = () => {\n  //   if (currentIntervalId) {\n  //     clearInterval(currentIntervalId)\n  //   }\n  //   var intId = setInterval(() => {\n  //     getAllGames()\n  //   }, 6000)\n  //   setCurrentIntervalId(intId)\n  // }\n\n  const gamePolling = () => {\n    if (currentIntervalId) {\n      clearInterval(currentIntervalId)\n    }\n    var intId = setInterval(() => {\n      getAllGames()\n    }, 2000)\n    setCurrentIntervalId(intId)\n  }\n\n  return (\n    <div>\n      {!hueConfigured && <ConnectHue setHueUsername={setHueUsername} setHueConfigured={setHueConfigured} hueUsername={hueUsername} setCheckedLights={setCheckedLights} setBridgeIp={setBridgeIp} bridgeIp={bridgeIp} setLights={setLights} />}\n      { (hueConfigured && !gameView) &&\n        <div className=\"App\">\n          <LiveGames lightColorHex={lightColorHex} liveGames={liveGames} setHomeTeam={setHomeTeam} setAwayTeam={setAwayTeam} setAwayColor={setAwayColor} setHomeColor={setHomeColor} awayTeam={awayTeam} homeTeam={homeTeam} setGameView={setGameView} setSingleGameData={setSingleGameData} />\n          <PickColors setAwayColor={setAwayColor} setHomeColor={setHomeColor} awayTeam={awayTeam} homeTeam={homeTeam} setGameView={setGameView} />\n        </div>\n      }\n      { (hueConfigured && gameView) &&\n        <GamePage setDelay={setDelay} setIntervalId={setCurrentIntervalId} intervalId={currentIntervalId} delay={delay} homeTeam={homeTeam} awayTeam={awayTeam} homeColor={homeColor} awayColor={awayColor} liveGames={liveGames} setGameView={setGameView} gameView={gameView} lightColorHex={lightColorHex} setHomeColor={setHomeColor} setAwayColor={setAwayColor} />\n      }\n    </div>\n  );\n}\n\nexport default App;"]},"metadata":{},"sourceType":"module"}